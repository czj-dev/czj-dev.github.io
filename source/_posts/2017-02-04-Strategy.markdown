---
layout: post
title: "ç­–ç•¥æ¨¡å¼(Strategy Pettern)"
subtitle: "Head Firstå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰"
date: 2017-02-04 14:12:11
atuhor: "chenzhaojun"
header_image: "img/java.jpg"
tags:
    - åŸºç¡€
---

## å‰è¨€

ä»Šå¹´çš„è¯»ä¹¦è®¡åˆ’æ­£å¼å¼€å¼ äº†ï¼Œå…¶å®è¿‡å¹´çš„æ—¶å€™å°±æŠŠä¹¦å•ä¸­çš„ã€Šäº†ä¸èµ·çš„ç›–èŒ¨æ¯”ã€‹ç»™é˜…è¯»å®Œäº†ï¼Œä½†æ˜¯çœ‹å®Œå¦‚çŒªå…«æˆ’åƒäººå‚æœâ€”â€”ä¸çŸ¥å•¥æ»‹å‘³ã€‚åªçŸ¥é“å¤§æ¦‚çš„æ•…äº‹æƒ…èŠ‚ï¼Œä¹¦ä¸­åä¸½çš„è¯è—»ã€ä½œå“çš„è‰ºæœ¯å’Œä¸»é¢˜å¹¶ä¸èƒ½å®Œå…¨ä½“ä¼šï¼Œæ›´åˆ«è¯´å†™ä¸€äº›é˜…è¯»åçš„è§‚æ„Ÿäº†ã€‚æŠ½ç©ºè‚¯å®šæ˜¯è¦é‡æ–°é˜…è¯»å‡ éçš„ï¼Œæ‰€ä»¥å°±ä¸æŠŠå®ƒå½“ä½œå·²è¯»ä¹¦ç±äº†ã€‚

æ­£å¼çš„é˜…è¯»æ˜¯ä»ä»Šå¤©å¼€å§‹äº†ï¼Œå‡†å¤‡å­¦ä¹ æŠ€æœ¯æ–¹é¢çš„ä¹¦ç±ï¼Œä½†ä¹Ÿå…ˆæ¥ç‚¹è½»æ¾çš„ï¼Œå°±æ˜¯è¿™æœ¬ã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹ã€‚ä¹‹å‰çœ‹è¿‡ã€ŠHead First Javaã€‹ä¹¦ä¸­å†…å®¹é€šä¿—æ˜“æ‡‚ï¼Œç”ŸåŠ¨æœ‰è¶£æ˜¯æœ¬å…¥é—¨çš„å¥½ä¹¦ï¼Œè®¾è®¡æ¨¡å¼å‘¢æ˜¯å’Œé‚£æœ¬ä¹¦ä¸€èµ·ä¹°çš„ï¼Œä¹°äº†ä¹Ÿæœ‰äº›æ—¶å€™äº†ï¼Œä½†æ˜¯ä»å­¦æ ¡åˆ°å·¥ä½œéƒ½æ˜¯å„ç§åœ°æ–¹åƒç°çš„è§’è‰²ï¼Œä¸€ç›´ä¸èƒ½é™ä¸‹å¿ƒæ¥å®è·µï¼Œæ„Ÿåˆ°ååˆ†ç¾æ„§ã€‚å·¥ä½œä¸­ä¹Ÿç”¨åˆ°å’Œé˜…è¯»åˆ°å„ç§è®¾è®¡æ¨¡å¼å´ä¸€ç›´æ²¡æœ‰æ­£ç¡®çš„è®¤è¯†ï¼Œå‘ˆç°åœ¨èµ¶ç´§æ¡èµ·æ¥ã€‚

## æ­£æ–‡

> è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“ã€ç»è¿‡åˆ†ç±»ç¼–ç›®ã€ä»£ç è®¾è®¡çš„æ€»ç»“ã€‚å®ƒå‘Šè¯‰æˆ‘ä»¬å¦‚ä½•ç»„ç»‡ç±»å’Œå¯¹è±¡ä»¥è§£å†³æŸç§é—®é¢˜ã€‚è€Œä¸”é‡‡çº³è¿™äº›è®¾è®¡æ¨¡å¼å¹¶ä½¿å®ƒä»¬é€‚åˆæˆ‘ä»¬ç‰¹å®šçš„åº”ç”¨ï¼Œæ˜¯æˆ‘ä»¬è´£æ— æ—è´·çš„äº‹ã€‚




### è®¾è®¡åŸåˆ™

è™½ç„¶ä¹‹å‰å¹¶æ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ è®¾è®¡æ¨¡å¼ï¼Œä½†å¯¹è®¾è®¡æ¨¡å¼çš„å…­å¤§è®¾è®¡åŸåˆ™è¿˜æ˜¯ç•¥æœ‰è€³é—»çš„ã€‚ä¸è¿‡æœ¬ä¹¦ç›®å‰ä¸çŸ¥é“å‡ºäºä»€ä¹ˆåŸå› æ²¡æœ‰å»ä»‹ç»å®ƒï¼Œè€Œæ˜¯è‡ªå·±ç»„ç»‡è¯­è¨€ç›®å‰ä¹Ÿå°±ä¸å¾—è€ŒçŸ¥äº†ï¼Œå’±è¿˜æ˜¯æŒ‰ä¹¦ä¸Šçš„é€šä¿—æ˜“æ‡‚çš„å…ˆæ¥ã€‚

- **æ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ã€‚**
- **é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚**
- **å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿ã€‚**



### å®ç°ç­–ç•¥æ¨¡å¼

æˆ‘ä»¬é€šè¿‡`java`ä»£ç æ¥å®ç°ç­–ç•¥æ¨¡å¼ã€‚

ç°åœ¨å…¬å¸æœ‰ä¸€ç§äº§å“â€”â€”`Bird`(æ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™ï¼Œæˆ‘ä»¬çš„äº§å“å°±æ˜¯é¸Ÿï¼),è¿™åªé¸Ÿç›®å‰çš„åŠŸèƒ½æ˜¯`walk()`å’Œ`display`ã€‚æˆ‘ä»¬è¿˜å¼€è®¾äº†ä¸¤ä¸ªå­äº§å“ä¹Œé¸¦å’Œéº»é›€,å¦‚å›¾:

```mermaid
graph TB;
Bird["Bird<br> <br> <br>display()<br> <br>walk()"]
Bird --> crow["crow<br> <br>display() //å¤–è§‚æ˜¯é»‘è‰²"]
Bird --> sparrow["sparrow<br> <br>display() //å¤–è§‚æ˜¯é»„è‰²"]
style Bird fill:#FFFACD;

```

ä»Šå¹´ï¼Œå…¬å¸çš„ç«äº‰å‹åŠ›åŠ å‰§ï¼Œå…¬å¸ä¸»ç®¡è®¤ä¸ºæ˜¯è¯¥åˆ›æ–°çš„æ—¶å€™äº†ï¼Œä»–ä»¬éœ€è¦åœ¨ä¸‹ä¸€æ¬¡è‚¡ä¸œä¼šè®®ä¸Šå±•ç¤ºä¸€äº›"çœŸæ­£"è®©äººå°è±¡æ·±åˆ»çš„ä¸œè¥¿æ¥æŒ¯å¥‹äººå¿ƒäº†ï¼Œäºæ˜¯æˆ‘ä»¬å†³å®šè®©é¸Ÿèƒ½é£!

å°æ˜æ‹èƒ¸è„¯ä¿è¯ä¸€å‘¨å°±å¯ä»¥å®Œæˆ,ä»–æƒ³ä»–åªè¦åœ¨**`Bird`ç±»ä¸­åŠ ä¸Š`fly()`æ–¹æ³•ï¼Œè¿™æ ·æ‰€æœ‰é¸Ÿç±»å°±éƒ½ä¼šé£äº†**:

```mermaid
graph TB;
Bird["Bird<br> <br> <br>display()<br> <br>walk() <br> <br> fly() //ğŸ‘ˆå°æ˜åŠ ä¸Šçš„"]
Bird --> crow["crow<br> <br>display() //å¤–è§‚æ˜¯é»‘è‰²"]
Bird --> sparrow["sparrow<br> <br>display() //å¤–è§‚æ˜¯é»„è‰²"]
style Bird fill:#FFFACD;
```

å°æ˜è§‰å¾—å¤©è¡£æ— ç¼ï¼Œä½†æ˜¯åœ¨è‚¡ä¸œä¼šè®®ä¸Šçš„å±•ç¤ºä¸Šä¸»ç®¡å‘ç°æœ‰å¾ˆå¤šæ©¡èƒ¶é¸Ÿä¹Ÿåœ¨é£ï¼Œä¸»ç®¡è®©å°æ˜å°½å¿«çš„è§£å†³é—®é¢˜ï¼Œä¸ç„¶å°±å‡†å¤‡å»é€›å‰ç¨‹æ— å¿§å§ã€‚

**å°æ˜è§‰å¾—å¯ä»¥æŠŠæ©¡èƒ¶é¸Ÿç±»ä¸­çš„`fly()`æ–¹æ³•è¦†ç›–æ‰ï¼Œä½†æ˜¯ä»¥åå¦‚æœåŠ å…¥åˆ«çš„é¸Ÿç±»åˆä¼šå¦‚ä½•?å†ç»™é¸Ÿå¢åŠ ä¸€ä¸ªshoutçš„åŠŸèƒ½å‘¢?**

åˆ©ç”¨ç»§æ‰¿æ¥æä¾›`Bird`çš„è¡Œä¸ºï¼Œä¼šå¯¼è‡´:

- **ä»£ç åœ¨å¤šä¸ªå­ç±»ä¸­é‡å¤ã€‚**
- **å¾ˆéš¾çŸ¥é“æ‰€æœ‰é¸Ÿçš„å…¨éƒ¨è¡Œä¸ºã€‚**
- **æ”¹å˜ä¼šç‰µä¸€å‘åŠ¨å…¨èº«,é€ æˆå…¶ä»–é¸Ÿä¸æƒ³è¦çš„æ”¹å˜ã€‚**
- **è¿è¡Œæ—¶çš„è¡Œä¸ºä¸å®¹æ˜“æ”¹å˜ã€‚**

å¦‚æœç”¨æ¥å£å‘¢ï¼ŸåŒæ ·ä¸è¡Œ,ä½¿ç”¨æ¥å£ä¼šå¯¼è‡´å¤§é‡çš„é‡å¤ä»£ç ï¼Œå¦‚æœè¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹é£è¡Œçš„å§¿åŠ¿é‚£ä¹ˆæ¯ä¸ªé¸Ÿç±»çš„éƒ½è¦å»å¤„ç†ã€‚

è¿™æ—¶å€™ç­–ç•¥æ¨¡å¼å°±ä¸Šåœºäº†ï¼Œç­–ç•¥æ¨¡å¼çš„å®šä¹‰ :

> ```
> ç­–ç•¥æ¨¡å¼å®šä¹‰äº†ç®—æ³•æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹ä¸ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚
> ```

æˆ‘ä»¬å°†`fly()`å’Œ`shout()`åœ¨`Bird`ä¸­å£°æ˜å‡ºæ¥ï¼Œå¹¶æä¾›ä¸¤ä¸ªæ¥å£`FlyBehavior`å’Œ`ShoutBehavior`æ¥å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•

```java
/**
 * Bird
 */
public abstract class Bird {
    private FlyBehavior flyBehavior;
    private ShoutBehavior shoutBehavior;

    public abstract void display();

    public void flyPerform() {
      //è°ƒç”¨FlyBehaviorçš„flyæ–¹æ³•
        flyBehavior.fly();
    }

    public void shoutPerform() {
      //ShoutBehaviorçš„shoutæ–¹æ³•
        shoutBehavior.shout();
    }

    public void setFlyBehavior(FlyBehavior flyBehavior) {
        this.flyBehavior = flyBehavior;
    }

    public void setShoutBehavior(ShoutBehavior shoutBehavior) {
        this.shoutBehavior = shoutBehavior;
    }

    public void walk() {
        System.err.println("I was walking...");
    }
}

/**
 * FlyBehavior
 */
public interface FlyBehavior {
    void fly();
}

/**
 * ShoutBehavior
 */
public interface ShoutBehavior {
    void shout();
}

```

ä½ å¯èƒ½è¦éª‚å¨˜äº†ï¼Œè¿™ä¸è¿˜æ˜¯ä½¿ç”¨æ¥å£å—ï¼Œä½ ä¸«é€—æˆ‘?æ”¾ä¸‹æ‰‹é‡Œçš„æ¿å‡³åˆ«æ€¥ã€‚**æˆ‘ä»¬å°†é¸Ÿçš„è¡Œä¸ºä»¥æ¥å£çš„å½¢å¼å£°æ˜åœ¨é‡Œé¢ï¼Œè€Œå®ç°åˆ™æ”¾åœ¨åˆ†å¼€çš„ç±»ä¸­ï¼Œæ­¤ç±»ä¸“é—¨æä¾›æŸè¡Œä¸ºæ¥å£çš„å®ç°ï¼Œè¿™æ ·ï¼Œé¸Ÿç±»å°±ä¸å†éœ€è¦çŸ¥é“è¡Œä¸ºçš„å®ç°ç»†èŠ‚äº†ã€‚**

**é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œå…³é”®å°±åœ¨äºå¤šæ€ï¼Œç¨‹åºå¯ä»¥é’ˆå¯¹è¶…ç±»å‹ç¼–ç¨‹ï¼Œæ‰§è¡Œæ—¶ä¼šæ ¹æ®å®é™…çŠ¶å†µæ‰§è¡Œåˆ°çœŸæ­£çš„è¡Œä¸ºï¼Œä¸ä¼šè¢«ç»‘æ­»åœ¨è¶…ç±»å‹çš„è¡Œä¸ºä¸Šã€‚**

```mermaid
graph TB;
Bird["FlyBehavior<br> <br> <br>fly()"]
Bird --> Fly["Fly<br> <br>fly(){<br> <br> // I Can Fly<br>}"]
Bird --> FlyNoWay["FlyNoWay<br> <br>fly(){<br> <br>  //I Can`t Fly<br>}"]
style Bird fill:#FFFACD;
```

`FlyBehavior`å’Œ`ShoutBehavior`çš„å®ç°ç±»æˆ‘ä»¬å¾ˆç®€å•æˆ‘ä»¬å°±åªåˆ—ä¸¾ä¸€ä¸ª:

```java
public class FlyNoWay implements FlyBehavior {
    @Override
    public void fly() {
        System.err.println("I Can`t Fly");
    }
}
```



æ‰€æœ‰éƒ½å®Œæˆåï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªäº§å“å–œé¹ŠMagpieæ¥æµ‹è¯•æˆ‘ä»¬æ¨¡å¼ã€‚

```java
/**
 * å–œé¹Šâ€”â€”Birdçš„å®ç°ç±»
 */
public class Magpie extends Bird {
    public Magpie() {
        setFlyBehavior(new Fly());
        setShoutBehavior(new Shout());
    }

    @Override
    public void display() {
        System.err.println("I`m black");
    }
}

```

æˆ‘ä»¬æŒ‡å®šäº†Margpieçš„`fly()`å’Œ`Shout`çš„å®ç°ç±»ï¼Œç„¶åæˆ‘ä»¬è®©å®ƒé£èµ·æ¥:

```java
public class Main {

    public static void main(String args[]) {
         Magpie magpie=new Magpie();
         magpie.display();
         magpie.flyPerform();
         magpie.shoutPerform();
    }
}
```

è¾“å‡ºä¸º

```java
I`m black
I Can Fly
G G G...
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥è°ƒç”¨`seter`æ–¹æ³•æ¥åŠ¨æ€æ”¹å˜é¸Ÿçš„è¡Œä¸ºã€‚

```java
         magpie.setFlyBehavior(new FlyNoWay());
         magpie.flyPerform();
```

è¾“å‡ºä¸º:

```java
I`m black
I Can Fly
G G G...
I Can`t Fly
```

è¿™å°±æ˜¯ç­–ç•¥æ¨¡å¼ï¼Œä¸è¦æ€€ç–‘ã€‚å¤šäºè¿™ä¸ªæ¨¡å¼ï¼Œå°æ˜å¯ä»¥å‹¾ç”»ä»–çš„èµŒåŸç‹‚æ¬¢ä¹‹æ—…äº†ã€‚

ç°åœ¨å›å¤´çœ‹çœ‹æ•´ä½“çš„å¸ƒå±€

```mermaid
graph TB;
  subgraph å°è£…é£è¡Œè¡Œä¸º
FlyBehavior["FlyBehavior<br> <br> <br>fly()"]
FlyBehavior --> Fly["Fly<br> <br>fly(){<br> <br> // I Can Fly<br>}"]
FlyBehavior --> FlyNoWay["FlyNoWay<br> <br>fly(){<br> <br>  //I Can`t Fly<br>}"]
style FlyBehavior fill:#FFFACD;
    end
  subgraph å®¢æˆ·
Bird["Bird<br> <br> <br>display()<br> <br>walk() <br> <br> fly()"]
Bird --> crow["crow<br> <br>display() //å¤–è§‚æ˜¯é»‘è‰²"]
Bird --> sparrow["sparrow<br> <br>display() //å¤–è§‚æ˜¯é»„è‰²"]
style Bird fill:#FFFACD;
    end
   subgraph å°è£…å«å–Šè¡Œä¸º
ShoutBehavior["ShoutBehavior<br> <br> <br>fly()"]
ShoutBehavior --> Shout["Fly<br> <br>fly(){<br> <br> // I Can Fly<br>}"]
ShoutBehavior --> NoShout["FlyNoWay<br> <br>fly(){<br> <br>  //I Can`t Fly<br>}"]
style ShoutBehavior fill:#FFFACD;
    end
Bird --> FlyBehavior
Bird --> ShoutBehavior
```

