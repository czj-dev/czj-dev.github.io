I"NŠ<blockquote>
  <p>åœ¨å¯¹è±¡ä¹‹é—´å®šä¹‰ä¸€å¯¹å¤šçš„ä¾èµ–ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€ï¼Œä¾èµ–å®ƒçš„å¯¹è±¡éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°</p>
</blockquote>

<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>

<p>è§‚å¯Ÿè€…æ¨¡å¼åº”è¯¥æ˜¯<code class="highlighter-rouge">Java</code>å’Œ<code class="highlighter-rouge">Android</code>ä¸­ç”¨åˆ°çš„éå¸¸å¤šçš„ä¸€ä¸ªè®¾è®¡æ¨¡å¼äº†ï¼Œ<code class="highlighter-rouge">Java</code>è¿˜æä¾›äº†<code class="highlighter-rouge">Observer</code>ç›¸å…³çš„å®ç°ç±»ï¼Œå®ƒä»¬åœ¨<code class="highlighter-rouge">java.util.*</code>ä¸‹ï¼Œä½†å®ƒçš„<code class="highlighter-rouge">Observable</code>æ˜¯ä¸ªå®ç°ç±»ï¼Œæˆ‘ä»¬ä½¿ç”¨æ—¶éœ€è¦ç»§æ‰¿å®ƒ,è¿™æ ·å¹¶ä¸æ–¹ä¾¿æˆ‘ä»¬çš„ä½¿ç”¨ï¼Œ ä»Šå¤©æˆ‘ä»¬å°±å‚ç…§ä¹¦ç±å’Œç›¸å…³ç±»è‡ªå·±å®ç°ä¸€ä¸ªä¼ ç»Ÿçš„<code class="highlighter-rouge">è§‚å¯Ÿè€…æ¨¡å¼</code>ã€‚</p>

<p>ä¸Šä¸€æ¬¡æˆ‘ä»¬å…¬å¸é€šè¿‡<a href="https://mr9527.github.io/2017/02/04/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F(StrategyPattern)/"><strong>ç­–ç•¥æ¨¡å¼(StrategyPattern)</strong></a>æ¥å®ç°äº†ä¸€ä¸ªæš‚æ—¶å®Œç¾çš„äº§å“â€œBirdâ€ã€‚å…¬å¸å·²ç»æ­¥å…¥äº†æ­£è½¨ï¼Œåæ°”ä¹Ÿé€æ¸å¤§äº†èµ·æ¥ï¼Œæ°”è±¡ç«™çš„è€æ¿<strong>Just</strong>æ‰¾åˆ°æˆ‘ä»¬æƒ³è®©æˆ‘ä»¬å¸®å®ƒåšä¸€æ¬¾æ°”è±¡ç«™çš„åº”ç”¨ã€‚</p>

<p>åº”ç”¨çš„åŠŸèƒ½æ˜¯ä¸‰å—å¸ƒå‘Šæ¿ï¼Œä¸€å—ç”¨æ¥æ˜¾ç¤ºå½“å¤©çš„<strong>temperature(æ¸©åº¦)</strong>ã€<strong>humidity(æ¹¿åº¦)</strong>ä¸<strong>pressure(æ°”å‹)</strong>,å¦ä¸€å—ç”¨æ¥æ˜¾ç¤ºå¤©æ°”é¢„æŠ¥ï¼Œæœ€åä¸€å—ç”¨æ¥æ˜¾ç¤ºå½“å‰æ¸©åº¦çš„é…·çƒ­æŒ‡æ•°(å°±æ˜¯å¤©æ°”çˆ½ä¸çˆ½)ã€‚å½“ç„¶è¿™åªæ˜¯ç›®å‰çš„åŠŸèƒ½ï¼Œä»¥åå¯èƒ½ä¼šéšæ—¶å¢åŠ æˆ–ç§»é™¤å…¬å‘Šæ¿ã€‚</p>

<h3 id="è®¾è®¡ç¨‹åº">è®¾è®¡ç¨‹åº</h3>

<p>è§‚å¯Ÿè€…æ¨¡å¼æœ‰ä¸¤ä¸ªä¸»è¦çš„è§’è‰² :å¯è§‚å¯Ÿçš„å¯¹è±¡<code class="highlighter-rouge">observable</code>æˆ–è€…ä¹Ÿå«åš<code class="highlighter-rouge">Subject</code>ï¼Œè®¢é˜…è€…<code class="highlighter-rouge">observer</code>ã€‚å½“<code class="highlighter-rouge">observable</code>å‘ç”Ÿæ”¹å˜çš„æ—¶å€™(è¿™é‡Œå¯¹åº”çš„å°±æ˜¯å¤©æ°”å‘ç”Ÿäº†å˜åŒ–),å®ƒä¼šé€šçŸ¥æ‰€æœ‰çš„<code class="highlighter-rouge">observer</code>(å¸ƒå‘Šæ¿),è®©å®ƒä»¬æ ¹æ®æƒ…å†µå»åšè‡ªå·±çš„äº‹æƒ…(æ›´æ–°æ˜¾ç¤ºçš„æ•°æ®)ã€‚</p>

<p>æ°”è±¡ç«™çš„åŠŸèƒ½å’Œè§‚å¯Ÿè€…æ¨¡å¼éå¸¸å»åˆ,å°æ˜å†³å®šç›´æ¥å‚ç…§<code class="highlighter-rouge">Java</code>ä¸­çš„<code class="highlighter-rouge">Observer</code>æ¥å®ç°:</p>

<p>è®°å¾—ä¸Šä¸€æ¬¡æèµ·çš„è®¾è®¡åŸåˆ™â€”â€”<strong>é’ˆå¯¹æ¥å£ç¼–ç¨‹,è€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹</strong>.æˆ‘ä»¬å°†<code class="highlighter-rouge">observer</code>å’Œ<code class="highlighter-rouge">observable</code>çš„åŠŸèƒ½éƒ½ç”¨æ¥å£æ¥å£°æ˜:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c1">//observable</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Observable</span> <span class="o">{</span>

    <span class="kt">void</span> <span class="nf">registerObserver</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">removeObserver</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">notifyObserver</span><span class="o">(</span><span class="nc">Object</span> <span class="n">arg</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">//observer</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Observer</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Observable</span> <span class="n">observable</span><span class="o">,</span><span class="nc">Object</span> <span class="n">arg</span><span class="o">);</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™æ ·æˆ‘ä»¬å°±å°†<code class="highlighter-rouge">observable</code>çš„æ³¨å†Œã€æ³¨é”€ã€å’Œæ¨é€ä¸<code class="highlighter-rouge">Observer</code>çš„æ›´æ–°éƒ½ç»™æŠ½ç¦»å‡ºæ¥äº†å‡å°‘äº†è€¦åˆå¢åŠ äº†æ‰©å±•æ€§ã€‚</p>

<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„å°±æ˜¯æˆ‘ä»¬çš„<code class="highlighter-rouge">observer</code>éƒ½ä¸€ä¸ªé€šç”¨çš„åŠŸèƒ½â€”â€”æŠ•å½±åˆ°å…¬å‘Šæ¿ï¼Œè¿™ä¸€ç‚¹åœ¨è®¾è®¡åŸåˆ™ä¸­ä¹Ÿæåˆ°äº†â€”â€”<strong>æ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ã€‚</strong>æˆ‘ä»¬ä¹Ÿå°†è¿™ä¸ªåŠŸèƒ½æŠ½ç¦»å‡ºæ¥ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DisplayElement</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">display</span><span class="o">();</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ç¨‹åºè®¾è®¡å®Œäº†,æ¥çœ‹çœ‹ UML å›¾ :</p>

<p><img src="http://ok6cuokj5.bkt.clouddn.com/observer.png" alt="Observerç»“æ„å›¾" /></p>

<p>å†æ¥çœ‹å…·ä½“çš„å®ç° :</p>

<h3 id="æ°”è±¡ç«™">æ°”è±¡ç«™</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WeatherData</span> <span class="kd">implements</span> <span class="nc">Observable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">temperature</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">humidity</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">pressure</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Observer</span><span class="o">&gt;</span> <span class="n">observers</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">changed</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">WeatherData</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">observers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Observer</span><span class="o">&gt;();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setWeatherData</span><span class="o">(</span><span class="kt">float</span> <span class="n">temperature</span><span class="o">,</span> <span class="kt">float</span> <span class="n">humidity</span><span class="o">,</span> <span class="kt">float</span> <span class="n">pressure</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">temperature</span> <span class="o">=</span> <span class="n">temperature</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">humidity</span> <span class="o">=</span> <span class="n">humidity</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">pressure</span> <span class="o">=</span> <span class="n">pressure</span><span class="o">;</span>
        <span class="n">measurementsChanged</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">getTemperature</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">temperature</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">getHumidity</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">humidity</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">getPressure</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">pressure</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setChanged</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">changed</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">changed</span> <span class="o">=</span> <span class="n">changed</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clearChanged</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">changed</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">measurementsChanged</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ•°æ®å‘ç”Ÿäº†æ”¹å˜"</span><span class="o">);</span>
        <span class="n">notifyObserver</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerObserver</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">observers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">observer</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeObserver</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">observers</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">observer</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">observers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notifyObserver</span><span class="o">(</span><span class="nc">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">changed</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span> <span class="o">:</span> <span class="n">observers</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">observer</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">arg</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">clearChanged</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æˆ‘ä»¬åœ¨æ°”è±¡ç«™é€šè¿‡ä¸€ä¸ª<code class="highlighter-rouge">List</code>æ¥ç®¡ç†è®¢é˜…è€…ä»¬ï¼Œå½“æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶å€™å»é€šçŸ¥å®ƒä»¬ï¼Œå¯ä»¥çœ‹åˆ°å®Œå…¨æ˜¯é¢å‘å¯¹è±¡çš„æ–¹å¼å®ç°çš„ï¼Œ<code class="highlighter-rouge">observable</code>å¹¶ä¸çŸ¥é“ä¹Ÿä¸éœ€è¦çŸ¥é“å®ƒçš„<code class="highlighter-rouge">observer</code>æœ‰å“ªäº›åŠŸèƒ½ã€‚è‡³äºä¸ºä»€ä¹ˆåŠ ä¸€ä¸ªå¼€å…³<code class="highlighter-rouge">changed</code>ï¼Œæ˜¯å› ä¸ºè¿™æ ·æˆ‘ä»¬å¯ä»¥æ›´å¥½çš„æ§åˆ¶å¸ƒå‘Šæ¿çš„æ˜¾ç¤ºï¼Œæˆ‘ä»¬ä¸èƒ½æ¯æ¬¡å‘ç”Ÿä¸€ç‚¹æ”¹åŠ¨å°±å»æ›´æ–°å®ƒï¼Œé‚£æ ·ç”¨æˆ·çš„è®¾å¤‡ä¼šçˆ†ç‚¸çš„(å½“ç„¶æ²¡é‚£ä¹ˆä¸¥é‡),æœ‰äº†è¿™ä¸ªâ€å¼€å…³â€æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶å®ƒçš„é¢‘ç‡ï¼Œæ¯”å¦‚æ¯éš”ä¸€æ®µæ—¶é—´å‘é€ä¸€æ¬¡ï¼Œæˆ–è€…å˜åŠ¨è¾ƒå¤§å‘é€ä¸€æ¬¡ã€‚</p>

<h3 id="å¤©æ°”æ•°æ®å¸ƒå‘Šæ¿">å¤©æ°”æ•°æ®å¸ƒå‘Šæ¿</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CurrentConditionsDisplay</span> <span class="kd">implements</span> <span class="nc">Observer</span><span class="o">,</span> <span class="nc">DisplayElement</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Observable</span> <span class="n">observable</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CurrentConditionsDisplay</span><span class="o">(</span><span class="nc">Observable</span> <span class="n">observable</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">observable</span> <span class="o">=</span> <span class="n">observable</span><span class="o">;</span>
        <span class="n">observable</span><span class="o">.</span><span class="na">registerObserver</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Observable</span> <span class="n">observable</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">observable</span> <span class="o">=</span> <span class="n">observable</span><span class="o">;</span>
        <span class="n">display</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">observable</span> <span class="k">instanceof</span> <span class="nc">WeatherData</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">WeatherData</span> <span class="n">data</span> <span class="o">=</span> <span class="o">(</span><span class="nc">WeatherData</span><span class="o">)</span> <span class="n">observable</span><span class="o">;</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ¸©åº¦"</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">getTemperature</span><span class="o">()</span> <span class="o">+</span> <span class="s">"æ¹¿åº¦"</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">getHumidity</span><span class="o">()</span> <span class="o">+</span> <span class="s">"æ°”å‹"</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">getPressure</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æˆ‘ä»¬é€šè¿‡å¤šæ€æ¥è·å¾—<code class="highlighter-rouge">observable</code>çš„ä¿¡æ¯ï¼Œç„¶åè°ƒç”¨<code class="highlighter-rouge">dispaly()</code>æ¥æ˜¾ç¤ºå¸ƒå‘Šæ¿ã€‚</p>

<h3 id="å¤©æ°”é¢„æŠ¥å¸ƒå‘Šæ¿">å¤©æ°”é¢„æŠ¥å¸ƒå‘Šæ¿</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForecastDisplay</span> <span class="kd">implements</span> <span class="nc">Observer</span><span class="o">,</span> <span class="nc">DisplayElement</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">currentPressure</span> <span class="o">=</span> <span class="mf">29.92f</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">lastPressure</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Observable</span> <span class="n">weatherData</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ForecastDisplay</span><span class="o">(</span><span class="nc">Observable</span> <span class="n">weatherData</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">weatherData</span> <span class="o">=</span> <span class="n">weatherData</span><span class="o">;</span>
        <span class="n">weatherData</span><span class="o">.</span><span class="na">registerObserver</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Forecast: "</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">currentPressure</span> <span class="o">&gt;</span> <span class="n">lastPressure</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Improving weather on the way!"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">currentPressure</span> <span class="o">==</span> <span class="n">lastPressure</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"More of the same"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">currentPressure</span> <span class="o">&lt;</span> <span class="n">lastPressure</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Watch out for cooler, rainy weather"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Observable</span> <span class="n">observable</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">observable</span> <span class="k">instanceof</span> <span class="nc">WeatherData</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">lastPressure</span> <span class="o">=</span> <span class="n">currentPressure</span><span class="o">;</span>
            <span class="n">currentPressure</span> <span class="o">=</span> <span class="o">((</span><span class="nc">WeatherData</span><span class="o">)</span> <span class="n">observable</span><span class="o">).</span><span class="na">getPressure</span><span class="o">();</span>
            <span class="n">display</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="é…·çƒ­æŒ‡æ•°å¸ƒå‘Šæ¿">é…·çƒ­æŒ‡æ•°å¸ƒå‘Šæ¿</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComfortLevelDisplay</span> <span class="kd">implements</span> <span class="nc">Observer</span><span class="o">,</span> <span class="nc">DisplayElement</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Observable</span> <span class="n">observable</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ComfortLevelDisplay</span><span class="o">(</span><span class="nc">Observable</span> <span class="n">observable</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">observable</span> <span class="o">=</span> <span class="n">observable</span><span class="o">;</span>
        <span class="n">observable</span><span class="o">.</span><span class="na">registerObserver</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Observable</span> <span class="n">observable</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">observable</span> <span class="o">=</span> <span class="n">observable</span><span class="o">;</span>
        <span class="n">display</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">observable</span> <span class="k">instanceof</span> <span class="nc">WeatherData</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">double</span> <span class="n">comfortLevel</span> <span class="o">=</span> <span class="n">getComfortLevel</span><span class="o">(((</span><span class="nc">WeatherData</span><span class="o">)</span> <span class="n">observable</span><span class="o">).</span><span class="na">getTemperature</span><span class="o">(),</span> <span class="o">((</span><span class="nc">WeatherData</span><span class="o">)</span> <span class="n">observable</span><span class="o">).</span><span class="na">getHumidity</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"é…·çƒ­æŒ‡æ•° :  "</span> <span class="o">+</span> <span class="n">comfortLevel</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getComfortLevel</span><span class="o">(</span><span class="kt">float</span> <span class="n">t</span><span class="o">,</span> <span class="kt">float</span> <span class="n">rh</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="mf">16.923</span> <span class="o">+</span> <span class="o">(</span><span class="mf">0.185212</span> <span class="o">*</span> <span class="n">t</span><span class="o">)</span> <span class="o">+</span> <span class="o">(</span><span class="mf">5.37941</span> <span class="o">*</span> <span class="n">rh</span><span class="o">)</span> <span class="o">-</span> <span class="o">(</span><span class="mf">0.100254</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">rh</span><span class="o">)</span>
                <span class="o">+</span> <span class="o">(</span><span class="mf">0.00941695</span> <span class="o">*</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">t</span><span class="o">))</span> <span class="o">+</span> <span class="o">(</span><span class="mf">0.00728898</span> <span class="o">*</span> <span class="o">(</span><span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span><span class="o">))</span>
                <span class="o">+</span> <span class="o">(</span><span class="mf">0.000345372</span> <span class="o">*</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">rh</span><span class="o">))</span> <span class="o">-</span> <span class="o">(</span><span class="mf">0.000814971</span> <span class="o">*</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span><span class="o">))</span> <span class="o">+</span>
                <span class="o">(</span><span class="mf">0.0000102102</span> <span class="o">*</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span><span class="o">))</span> <span class="o">-</span> <span class="o">(</span><span class="mf">0.000038646</span> <span class="o">*</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span><span class="o">))</span> <span class="o">+</span> <span class="o">(</span><span class="mf">0.0000291583</span> <span class="o">*</span>
                <span class="o">(</span><span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span><span class="o">))</span> <span class="o">+</span> <span class="o">(</span><span class="mf">0.00000142721</span> <span class="o">*</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">rh</span><span class="o">))</span> <span class="o">+</span>
                <span class="o">(</span><span class="mf">0.000000197483</span> <span class="o">*</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span><span class="o">))</span> <span class="o">-</span> <span class="o">(</span><span class="mf">0.0000000218429</span> <span class="o">*</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span><span class="o">))</span> <span class="o">+</span>
                <span class="mf">0.000000000843296</span> <span class="o">*</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span><span class="o">))</span> <span class="o">-</span>
                <span class="o">(</span><span class="mf">0.0000000000481975</span> <span class="o">*</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span> <span class="o">*</span> <span class="n">rh</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™ä¸€å¤§å¨ä»£ç å°±æ˜¯ç”¨æ¥è®¡ç®—â€é…·çƒ­æŒ‡æ•°çš„â€ã€‚è‡³äºä¸ºä»€ä¹ˆè¿™ä¹ˆå†™ï¼Œä½ å¯ä»¥é—®æ°”è±¡å±€æˆ–è€…ç™¾åº¦~ã€‚</p>

<p>æœ€åæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">WeatherData</span> <span class="n">weatherData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WeatherData</span><span class="o">();</span>
        <span class="nc">ComfortLevelDisplay</span> <span class="n">comfortLevelDisplay</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ComfortLevelDisplay</span><span class="o">(</span><span class="n">weatherData</span><span class="o">);</span>
        <span class="nc">CurrentConditionsDisplay</span> <span class="n">currentConditionsDisplay</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CurrentConditionsDisplay</span><span class="o">(</span><span class="n">weatherData</span><span class="o">);</span>
        <span class="nc">ForecastDisplay</span> <span class="n">forecastDisplay</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ForecastDisplay</span><span class="o">(</span><span class="n">weatherData</span><span class="o">);</span>

        <span class="n">weatherData</span><span class="o">.</span><span class="na">setWeatherData</span><span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">14</span><span class="o">,</span> <span class="mi">15</span><span class="o">);</span>
        <span class="n">weatherData</span><span class="o">.</span><span class="na">setChanged</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">weatherData</span><span class="o">.</span><span class="na">setWeatherData</span><span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="mi">16</span><span class="o">);</span>
        <span class="n">weatherData</span><span class="o">.</span><span class="na">setWeatherData</span><span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="mi">16</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>æˆ‘ä»¬åœ¨æ°”è±¡ç«™ä¸­æ›´æ–°äº†ä¸‰æ¬¡æ•°æ®æ¥çœ‹çœ‹å…¬å‘Šæ¿æ˜¯å¦‚ä½•æ˜¾ç¤ºçš„å§ :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nl">log:</span> <span class="n">æ•°æ®å‘ç”Ÿäº†æ”¹å˜</span>
<span class="nl">log:</span> <span class="n">æ•°æ®å‘ç”Ÿäº†æ”¹å˜</span>
<span class="n">é…·çƒ­æŒ‡æ•°</span> <span class="o">:</span>  <span class="mf">84.45697418607358</span>
<span class="n">æ¸©åº¦15</span><span class="o">.</span><span class="mi">0</span> <span class="n">æ¹¿åº¦16</span><span class="o">.</span><span class="mi">0</span> <span class="n">æ°”å‹16</span><span class="o">.</span><span class="mi">0</span>
<span class="nl">Forecast:</span> <span class="nc">Watch</span> <span class="n">out</span> <span class="k">for</span> <span class="n">cooler</span><span class="o">,</span> <span class="n">rainy</span> <span class="n">weather</span>
<span class="nl">log:</span> <span class="n">æ•°æ®å‘ç”Ÿäº†æ”¹å˜</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ˜¯ä¸æ˜¯å’Œä½ é¢„æœŸçš„ä¸€æ ·å‘¢,è§‚å¯Ÿè€…æ¨¡å¼åœ¨è¿™é‡Œå°±ä»‹ç»å®Œäº†ã€‚</p>

<blockquote>
  <p>ä¸ºäº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆè®¾è®¡è€ŒåŠªåŠ›</p>
</blockquote>

<h2 id="è¦ç‚¹">è¦ç‚¹</h2>

<ul>
  <li>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†å¯¹è±¡ä¹‹é—´ä¸€å¯¹å¤šçš„å…³ç³»ã€‚</li>
  <li>ä¸»é¢˜ï¼ˆä¹Ÿå°±æ˜¯å¯è§‚å¯Ÿè€…ï¼‰ç”¨ä¸€ä¸ªå…±åŒçš„æ¥å£æ¥æ›´æ–°è§‚å¯Ÿè€…ã€‚</li>
  <li>è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…ä¹‹é—´ç”¨æ¾è€¦åˆæ–¹å¼ç»“åˆï¼Œå¯è§‚å¯Ÿè€…ä¸çŸ¥é“è§‚å¯Ÿè€…çš„ç»†èŠ‚ï¼ŒåªçŸ¥é“è§‚å¯Ÿè€…å®ç°äº†è§‚å¯Ÿè€…æ¥å£ã€‚</li>
  <li>ä½¿ç”¨æ­¤æ¨¡å¼æ—¶ï¼Œä½ å¯ä»¥ä»è¢«è§‚å¯Ÿè€…å¤„æ¨(pus)æˆ–æ‹‰(pull)æ•°æ®(æ¨çš„æ–¹å¼è¢«è®¤ä¸ºæ›´â€æ­£ç¡®â€)ã€‚</li>
  <li>æœ‰å¤šä¸ªè§‚å¯Ÿè€…æ—¶ï¼Œä¸å¯ä»¥ä¾èµ–ç‰¹å®šçš„é€šçŸ¥æ¬¡åºã€‚</li>
  <li>Java æœ‰å¤šç§è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ï¼ŒåŒ…æ‹¬äº†é€šç”¨çš„<code class="highlighter-rouge">java.util.Obseravble</code>ã€‚</li>
</ul>

<p>day day up</p>
:ET